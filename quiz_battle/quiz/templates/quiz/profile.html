{% extends 'base.html' %}

{% block content %}
<div class="profile-container">
  {% if request.user.is_authenticated %}
    <h2>Profile</h2>
    <div class="profile-card">
      <p><strong>Nickname:</strong> {{ request.user.username }}</p>
      <p><strong>Email:</strong> {{ request.user.email }}</p>
      <p><strong>Total Score:</strong> {{ profile.score }}</p>
      {% if best_result %}
        <p><strong>Best Game:</strong> {{ best_result.score }} points ({{ best_result.quiz_type|title }}, {{ best_result.started_at|date:'Y-m-d H:i' }})</p>
      {% endif %}
      <h4 class="mt-4">Achievements</h4>
      <ul>
        {% for ach in achievements %}
          <li>üèÖ {{ ach }}</li>
        {% empty %}
          <li>No achievements yet.</li>
        {% endfor %}
      </ul>
      <h4 class="mt-4">Game History</h4>
      <table class="table table-sm table-bordered mt-2">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Score</th>
            <th>Challenge</th>
          </tr>
        </thead>
        <tbody>
          {% for game in game_history %}
          <tr>
            <td>{{ game.started_at|date:'Y-m-d H:i' }}</td>
            <td>{{ game.quiz_type|title }}</td>
            <td>{{ game.score }}</td>
            <td>{% if game.is_challenge %}Yes{% else %}No{% endif %}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">No games played yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>

      <h4 class="mt-4">Challenge Mode High Scores</h4>
      <table class="table table-sm table-bordered mt-2">
        <thead>
          <tr>
            <th>Player</th>
            <th>Score</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for result in challenge_scores %}
          <tr>
            <td>{{ result.user.username }}</td>
            <td>{{ result.score }}</td>
            <td>{{ result.started_at|date:'Y-m-d H:i' }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="3">No challenge scores yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>

      <a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>
    </div>
  {% else %}
    <div class="profile-card">
      <h3>You are not signed in.</h3>
      <a href="{% url 'login' %}" class="btn btn-primary">Sign in</a>
    </div>
  {% endif %}
</div>
<style>
.profile-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.profile-card {
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.back-btn {
  margin-top: 20px;
}
</style>
{% endblock %}